$(function(){$(".menu_tab a.on").parent("dd").addClass("cur")});var cmCookieHelper=function(){var e=window.location.href,c="#comm_tx",b=e.indexOf(c),d="comm_cont_"+(b>0?e.substring(0,b):e);return{A:c,val:function(){return $.cookie(d)},set:function(a){$.cookie(d,a,{expires:1})},del:function(){$.cookie(d,null)}}}();function agreeObj(){$(".agr_btn").live("click",function(c){c.preventDefault();var b=$(this).attr("typeid");var e=$(this).attr("resid");var a=$.cookie("agr_"+e+"_"+b);if(a!=null){$.toast("你已经点过赞了");return}var d=$(this);LoadingDialog.show();$.ajax({type:"POST",dataType:"json",url:"/servlet/agreeobj",data:"resId="+e+"&typeId="+b,success:function(f){LoadingDialog.hide();if(f[0]==1){increaseNum(d);if($(".love_btn").length>0){d.removeClass("love_btn");d.addClass("love_btn_click")}$.cookie("agr_"+e+"_"+b,"1",{expires:1,path:"/"})}else{if(f[0]==-1){openLogin(RW)}else{$.alert(f[1])}}}})})}$(function(){agreeObj()});function classicLines(){$(".addCL").bind("click",function(b){b.preventDefault();if(gUser.id==0){openLogin(RW);return false}var a=new jwindow("classic_wp",{width:450,title:"添加经典台词"});a.appendContent('<p><input placeholder="剧中某角色" type="text" id="whosaid" size="18"/>说：<span class="gray">(可选)</span></p>');a.appendContent('<textarea id="classicLines" style="width:100%;height:80px"></textarea>');a.addOkButton("提交").click(function(e){e.preventDefault();if($(this).attr("done")){return}var d=$("#classicLines").val();if($.trim(d)==""){return}var c=$("#whosaid").val();$(this).attr("done",1);LoadingDialog.show();$.ajax({type:"POST",dataType:"json",url:"/servlet/AddClassisLines",data:"objId="+gObject.id+"&content="+$.encode(d)+"&whosaid="+$.encode(c)+"&ret=true",success:function(f){if(f[0]==1){a.close();$.toast("您添加的台词会在审核后才予以显示")}else{$.alert(f[1])}LoadingDialog.hide()}})});a.addCancelButton();a.show()});if($("ul.lines").children().length==0){$("ul.lines").append('<li flag="tips">还没有人发现经典台词，你一定发现了，赶快来加吧！</li>')}}$(function(){classicLines()});function bindObjLove(){$(".click_like").click(function(c){c.preventDefault();var e=$(this);var a=$("#link_num");var b=e.attr("typeid");var d=e.attr("resid");LoadingDialog.show();$.ajax({type:"POST",url:"/servlet/favobject",data:"resourceid="+d+"&typeid="+b,dataType:"json",success:function(f){LoadingDialog.hide();if(f[0]==1){if($(".love_btn").length>0){increaseNum(e);e.removeClass("love_btn");e.addClass("love_btn_click")}else{increaseNum(a);e.hide();$(".cancel_like").show()}}else{if(f[0]==-1){openLogin(RW)}else{$.alert(f[1])}}}})});$(".cancel_like").click(function(){var d=$(this);var c=$("#link_num");var e=$(".lovebtn").attr("resid");var a=$(".lovebtn").attr("typeid");var b="typeid="+a+"&resourceid="+e;$.ajax({type:"POST",dataType:"json",url:"/servlet/delfavobject",data:b,success:function(g){if(g[0]==1){d.hide();$(".lovebtn").show();var f=parseInt(c.text().replace(new RegExp("[^0-9]+"),""))-1;c.text(c.text().replace(/\d+/,f))}else{$.alert(g[1])}}})})}$(function(){bindObjLove()});function o_bookmark(b,g,c){var f=$("#favo"+g);var e=f.attr("op")=="1";var d=e?"favobject":"delfavobject";var a="typeid="+b+"&resourceid="+g;if(c){a+="&countryId="+c}LoadingDialog.show();$.ajax({type:"POST",url:"/servlet/"+d,async:false,data:a,dataType:"json",success:function(j){LoadingDialog.hide();if(j[0]==1){var i=f.children("span").text();if(e){f.attr("op","0");f.children("span").text("取消"+i)}else{f.attr("op","1");f.children("span").text(i.replace("取消",""))}}else{if(j[0]==-1){openLogin(RW)}else{alert(j[1])}}}})}(function(a){if(a.browser.msie){try{document.execCommand("BackgroundImageCache",false,true)}catch(c){}}a.fn.starRating=function(){var f=a(this);var e=gObject.id;var d=getCurRating(f);a.each(a("li",f),function(){if(parseInt(a(this).text())<=d){a(this).addClass("on")}});a("li a",f).bind({focus:function(){a(this).blur()},click:function(){if(!gUser.logged){openLogin(RW);return false}else{var g=a(this).text();b(e,g,f)}},mouseover:function(){var g=parseInt(a(this).text());a.each(a("li",f),function(){if(parseInt(a("a",a(this)).text())<=g){a(this).addClass("on")}else{a(this).removeClass("on")}})},mouseleave:function(){var g=getCurRating(f);a.each(a("li",f),function(){if(parseInt(a("a",a(this)).text())<=g){a(this).addClass("on")}else{a(this).removeClass("on")}})}})};getCurRating=function(d){var e=a("li.curRating",d);var f=e.length==1?parseInt(e.text()):0;return f};function b(d,g,e){if(g==0){a.alert("请给个评价吧！");return false}var f=g;LoadingDialog.show();a.ajax({type:"POST",dataType:"json",url:"/servlet/scoreobject",data:"objectId="+d+"&score="+g,success:function(k){LoadingDialog.hide();if(k[0]==1){if(a("li.curRating",e).length==0){increaseNum(a('span[itemprop="ratingCount"]'))}a.each(a("li",e),function(){var l=parseInt(a("a",a(this)).text());a(this).removeClass("curRating");if(l<=f){a(this).addClass("on");if(l==f){a(this).addClass("curRating")}}else{a(this).removeClass("on")}});var j=k[1];var i=a(".rating-wrap .star,.rating2-wrap .star");i.css("width",j.w*parseInt(i.attr("icon_w")));a(".rating-wrap .unit,.rating2-wrap .unit").text(j.u);a(".rating-wrap .decimal,.rating2-wrap .decimal").text("."+j.d)}else{if(k[0]==-1){openLogin(RW)}else{a.alert(k[1])}}}})}})(jQuery);$(function(){$("#objRating").starRating()});(function(a){a.fn.subObjRating=function(){return this.each(function(){var c=a(this);if(c.hasClass("char_rate")){var g=a(".rate_list",c);var b=a("a.myrate",c);var e=parseInt(b.attr("val"));b.click(function(i){i.preventDefault();if(!gUser.logged){openLogin(RW);return false}a(this).hide();g.show();g.val(e)});g.change(function(){var i=a(":selected",g).val();submitRating(i,c,charRatingCallback)})}else{if(c.hasClass("epi_rate")){var f=a(".star-rating",c);_getCurRating=function(){var i=a("li.curRating",f);var j=i.length==1?parseInt(i.text()):0;return j};var d=_getCurRating();a.each(f.find("li"),function(){if(parseInt(a(this).text())<=d){a(this).addClass("on")}});a("li a",f).bind({focus:function(){a(this).blur()},click:function(){if(!gUser.logged){openLogin(RW);return false}else{var i=a(this).text();submitRating(i,c,epiRatingCallback)}},mouseover:function(){var i=parseInt(a(this).text());a.each(f.find("li"),function(){if(parseInt(a("a",a(this)).text())<=i){a(this).addClass("on")}else{a(this).removeClass("on")}})},mouseleave:function(){var i=_getCurRating();a.each(f.find("li"),function(){if(parseInt(a("a",a(this)).text())<=i){a(this).addClass("on")}else{a(this).removeClass("on")}})}})}}})};charRatingCallback=function(f,c,e){var g=a(".rate_list",c);var b=a("a.myrate",c);var d=parseInt(b.attr("val"));if(d<1){increaseNum(a(".counter",c));b.attr("val",e)}g.hide();b.text("我的评分："+a(":selected",g).text()).show();a(".star",c).css("width",f.w);a(".score",c).text(f.u+"."+f.d)};epiRatingCallback=function(d,b,c){a.each(a("li",b),function(){var e=parseInt(a("a",a(this)).text());a(this).removeClass("curRating");if(e<=c){a(this).addClass("on");if(e==c){a(this).addClass("curRating")}}else{a(this).removeClass("on")}});a(".score",b).html(d.u+"."+d.d)};submitRating=function(d,c,e){var b="typeId="+c.attr("typeid")+"&resId="+c.attr("resid")+"&cateId="+c.attr("cateid")+"&score="+d;LoadingDialog.show();a.ajax({type:"POST",dataType:"json",url:"/servlet/ScoreSubObject",data:b,success:function(g){LoadingDialog.hide();if(g[0]==1){var f=g[1];e(f,c,d)}else{if(g[0]==-1){openLogin(RW)}else{a.alert(g[1])}}}})}})(jQuery);$(function(){$(".char_rate,.epi_rate").subObjRating()});(function(a){a.fn.extend({vplay:function(){return this.each(function(){a(this).bind("click",function(e){e.preventDefault();var c=a(this).parent("div").attr("id");var b=a(this).attr("href");if(c!="main"){a(".plot li").removeClass("cur");a(this).parent("li").addClass("cur")}lleft=a(document).scrollLeft()+a(window).width()*0.5;ttop=a(window).height()*0.5;pp="toolbar=no,location=no,directories=no,status=no,menubar=yes,scrollbars=yes,resizable=yes,";if(b.indexOf("letv.com")!==-1){w=725;h=490;if(a.browser.msie){h=h+15}b+="#fla_box"}else{if(b.indexOf("tudou.com")!==-1){w=666;h=520;if(a.browser.msie){h=h+13}b+="#summary"}else{if(b.indexOf("kankan.com")!==-1){w=716;h=545;if(a.browser.msie){h=h+18}b+="#player_wide_bg"}else{if(b.indexOf("union.cntv.cn")!==-1){w=970;h=500;b+="#myFlash"}else{if(b.indexOf("tv.cntv.cn")!==-1){w=960;h=600;if(a.browser.msie){h=h+30}b+="#page_body"}else{if(b.indexOf("pps.tv")!==-1){w=1050;h=505;if(a.browser.msie){w=w-15}b=b.replace("#from_splay","?from_tvmao");b=b.replace("#from_tvmao","?from_tvmao");b+="#p-players"}else{if(b.indexOf("iqiyi.com")!==-1){w=705;h=482;if(a.browser.msie){w=w-10;h=h+15}b+="#block-A"}else{if(b.indexOf("sohu.com")!==-1){w=655;h=456;if(a.browser.msie){w=w-10;h=h+10}if(b.indexOf("lqd=10126")<0){if(b.indexOf("?")<0){b+="?lqd=10126"}else{b+="&lqd=10126"}}b+="#crumbsBar"}else{if(b.indexOf("pptv.com")!==-1){w=711;h=435;b+="?rcc_id=web_9014#pptv_playpage_box"}else{if(b.indexOf("mgtv.com")!==-1){w=952;h=575}else{if(b.indexOf("youku.com")!==-1){w=760;h=480;b+="?beta&#playBox"}else{if(b.indexOf("v.qq.com")!==-1){w=664;h=495;b+="#mod_barrage"}else{if(b.indexOf("funshion.com")!=-1){w=693;h=540;if(a.browser.msie){h=h+15}b+="#flash_area"}else{var d=window.open(b,"",pp+"top="+ttop+",left="+lleft+",width=760,height=650")}}}}}}}}}}}}}lleft=lleft-w/2;if(lleft<0){lleft=300}ttop=ttop-h/2;if(ttop<0){ttop=300}if(a.browser.msie){h=h-20}if(b.indexOf("ad_track")<1){b="http://www.tvmao.com/ad/ad_track.jsp?url="+a.encode(b)}var d=window.open(b,"",pp+"top="+ttop+",left="+lleft+",width="+w+",height="+h)})})}})})(jQuery);var maxTagsTips="最多3个印象哦!";var maxLengTips="单个印象最多不能超过10个汉字。";var TagDialog=function(g,b){this.submit=function(){if(this.posted){return}var n=this.tagInput.val();if(n.length==0){return}var m=$.trim(n).split(" ");if(m.length>3){$.alert(maxTagsTips);return false}for(var o in m){if(len(m[o])>20){$.alert(maxLengTips);return false}}this.posted=true;var a=this.tagWrap.attr("data")+"&tags="+$.encode(n);$this=this;$.ajax({type:"POST",url:"/servlet/AddObjectTagServlet",dataType:"json",data:a,success:function(i){this.posted=false;if(i[0]===1){$this.setMyTags(n);if(i[1].length>0){$this.refreshTagList(i[1])}$this.close()}else{$.alert(i[1])}}})};this.getAllTags=function(){var a=$(".tag_list li a span",this.tagWrap).toArray();var n=new Array();var m=0;for(var o in a){if(m>20){break}n.push(a[o].innerHTML);m++}return n};this.refreshTagList=function(a){this.tagWrap.empty().append(a)};this.getMyTags=function(){this.myTagWrap=$("#"+b);if(this.myTagWrap.length>0){if($("span",this.myTagWrap).hasClass("notag")){return""}var a=$("span",this.myTagWrap).text();return a.split(",")}else{return $("#init_mytags").val()}};this.setMyTags=function(i){this.myTagWrap=$("#"+b);var a=$.trim(i).replace(/[ 　]+/g,",");if(this.myTagWrap.length>0){$("span",this.myTagWrap).empty().append(a)}else{TagDialog.createMyTags(g,b,a)}};this.tagWrap=$("#"+g);this.posted=false;jwindow.call(this,"add_tag_w",{width:430,title:"添加印象"});this.appendContent("<p>多个印象之间用空格隔开，"+maxLengTips+"</p>");this.tagInput=$('<input type="text" id="tag_val" style="width:85%"/>');this.appendContent(this.tagInput);var d=this.getMyTags();var f="";for(var e in d){f+=d[e]+" "}this.tagInput.val(f);this.appendContent("<p>从热门印象中选择：</p>");this.hotTagList=$('<div class="hot_tags mt5 clear"></div>');var j=this.getAllTags();for(var e in j){var l=j[e];var k=$('<a href="#" class="ml5 lt mt5 tagbox">'+l+"</a>");for(var c in d){if(d[c]==l){k.addClass("mytag");break}}this.hotTagList.append(k)}$("a",this.hotTagList).click(this.bindToObj(function(q){q.preventDefault();var r=$(q.target);var a=r.text();var o=$.trim(this.tagInput.val()).split(" ");var n=r.hasClass("mytag");if(!n&&o.length>=3){$.alert(maxTagsTips);return false}var m="";for(var p in o){if(o[p]!=a){m+=o[p]+" "}}if(n){r.removeClass("mytag")}else{m+=a;r.addClass("mytag")}this.tagInput.val($.trim(m))}));this.appendContent(this.hotTagList);this.addOkButton("保存");this.addCancelButton("取消");this.okButton.click(this.bindToObj(function(a){this.submit()}))};TagDialog.prototype=new jwindow();TagDialog.initMyTags=function(b,a){var c=$("#init_mytags").val();TagDialog.createMyTags(b,a,c)};TagDialog.createMyTags=function(b,a,c){if(c!=""){var d=$('<div id="'+a+'" class="mt10 ml10"><label>我的印象：</label><span>'+c+"</span></div>");$("#"+b).after(d)}};$(function(){var b="tag_w";var a="mytag_w";$("a.addTag").click(function(c){c.preventDefault();if(gUser.id==0){openLogin(RW);return false}new TagDialog(b,a).show()});TagDialog.initMyTags(b,a);$(".tag_list a.tag").live("click",function(g){g.preventDefault();var i=$(this);var e=i.attr("tagid");var c=$("#"+b).attr("data")+"&tagId="+e;var k="tag"+e;if(gUser.id==0){var j=$.cookie(k);if(j){$.toast("同一印象只能点赞一次",2);return}else{$.cookie(k,"1",{expires:30,path:"/"})}}var d=$("#"+a+" span");var f="";if(d.length>0){f=d.text();if(f.indexOf(",")!=f.lastIndexOf(",")){$.alert(maxTagsTips);return false}}$.ajax({type:"POST",url:"/servlet/AgreeObjectTagServlet",dataType:"json",data:c,success:function(l){if(l[0]===1){increaseNum(i.children("em"));if(d.length==0){TagDialog.createMyTags(b,a,$("span",i).text())}else{if(f.length>0){f+=","}f+=$("span",i).text();d.text(f)}}else{$.alert(l[1])}}})});$("#showAll").live("click",function(){var c=$("#tag_w li.ui-helper-hidden");if($(this).html()=="展开全部"){$.each(c,function(){$(this).show()});$(this).html("收起部分")}else{$.each(c,function(){$(this).hide()});$(this).html("展开全部")}return false})});function initFocuspic(){var a=$(".rtive");$(".fixed_bg a",a).each(function(){$(this).mouseover(function(){var j=$("img",$(this));if(j.hasClass("bd_white")){return}var i=$(this).attr("desc");if(typeof(i)=="undefined"||i==""){i=$(this).attr("title")}var g=$(".focuspic a",a);var e=$("img",g);var c=$(this).attr("href");var b=$(this).attr("typeid");var f=$(this).attr("v_i");var d;if(b){if(b=="vote"){d="//static2.tvzhe.com/images/style/vote_big"+f+".png"}else{d="http://pix1.tvzhe.com/focuspic/"+b+"/"+$(this).attr("resid")+"/cate_focus_pic.jpg"}}else{d=e.attr("src").replace(/\/[0-9]+\//,"/"+$(this).attr("resid")+"/")}imgReady(d,function(){e.attr("src",d);e.attr("alt",j.attr("alt"));g.attr("href",c);$(".fixed_bg img").removeClass("bd_white");j.addClass("bd_white");$(".ftitle",a).html(i)})})})}$(function(){initFocuspic()});function wantorseen(a){$(".m_btn").click(function(){var e=$(this);var c=$(".m_want").attr("wantcount");var d=$(".m_seen").attr("seencount");var b=e.attr("tag");var f="typeId="+typeId+"&resId="+resId+"&tag="+b;$.ajax({dataType:"json",url:"/servlet/moviewantseen",data:f,success:function(l){if(l[0]==1){if(b=="5"){c=l[1]}else{d=l[1]}var k=$('<p class="font12 gray '+a+'"></p>');var i=$('<span class="font14 mr20 black"></span>');i.text(l[2]);var g=$('<span class="mr10"></span>');g.text(d+"人看过");var j=$("<span></span>");j.text(c+"人想看");k.append(i,g,j);$(".m_btn_div").find("div").hide();$(".m_btn_div").append(k)}else{$.toast(l[1])}}})})};