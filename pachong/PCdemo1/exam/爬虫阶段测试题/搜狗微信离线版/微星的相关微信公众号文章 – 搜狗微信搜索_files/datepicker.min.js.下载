(function(r,m,w){function p(a,b){var c=this,d=function(){},e;b=b||{};if(!(c instanceof p))return new p(a,b);e=c.$el=m(a);c.el=e[0];c.cache={};c.$body=m("body");c.defaults={current:new Date,weeks:"\u65e5\u4e00\u4e8c\u4e09\u56db\u4e94\u516d".split(""),between:[0,(new Date).getTime()],splitchar:"-",position:"bottom",deltaX:0,deltaY:0,onSelect:d,onShow:d,onHide:d,onDestroy:d};var d=c.options=m.extend({},c.defaults,b),f=d.current=d.current||new Date;d.year=f.getFullYear();d.month=f.getMonth()+1;d.day=f.getDate();c.el.value=c._format();e.off(".datepicker").on("click.datepicker",function(a){a=this.value;var b=m("div.sd-datepicker");b.length&&b.hide();c.$template&&c.validate(a)?(c.show(),a!=c.cache.value&&c.setValue(a)._update()):c._init();return!1})}p.prototype={version:"0.0.1",_init:function(){this.$template=m('<div class="sd-datepicker"><div class="sd-datepicker-header"><span class="sd-datepicker-year"></span>\u5e74<span class="sd-datepicker-month"></span>\u6708<a href="javascript:void(0)" class="btn-prev-month" data-action="prevMonth"></a><a href="javascript:void(0)" class="btn-next-month" data-action="nextMonth"></a></div><div class="sd-datepicker-body"></div>').appendTo("body");this.show();this.setValue(this.el.value);this._update();this._bindEvents();this._position()},_bindEvents:function(){var a=this,b=a.options,c=function(c){b.month+=c;12<b.month?(b.year++,b.month=1):1>b.month&&(b.year--,b.month=12);a._format();a._update()},d={prevMonth:function(){c(-1)},nextMonth:function(){c(1)},day:function(c){var d,k;c.hasClass("disabled")||(d=c.data("year"),k=c.data("month"),b.day=c.data("day"),d!=b.year||k!=b.month?(b.year=d,b.month=k,a.setValue(a._format()),a._update()):(a.setValue(a._format()),c.closest("tbody").find("td").removeClass("selected"),c.addClass("selected")),b.onSelect.call(a,b.year,b.month,b.day))}};a.$template.on("click",["data-action"],function(a){a=m(a.target);var b=a.data("action");b||(a=a.closest("td"),b=a.data("action"));d[b]&&d[b].call(a[0],a);return!1});m(r).on("resize",function(){a.$template&&a.$template.is(":visible")&&a._position()})},_position:function(){var a=this.options,b=this.$template;b.outerWidth();var c=b.outerHeight(),d=this.$el,e=d.outerWidth(),f=d.outerHeight(),d=d.offset(),k=a.deltaX,l=a.deltaY,g,n;switch(a.position){case"left":g=k+d.left-e;n=l+d.top;break;case"right":g=k+d.left+e;n=l+d.top;break;case"top":g=k+d.left;n=l+d.top-c;break;case"bottom":g=k+d.left,n=l+d.top+f}b.css({position:"absolute",left:g,top:n})},_update:function(){var a=this.cache,b=a.year,c=a.month,d=a.day,e=this.options,f=e.weeks,k=this._getDays(e.year,e.month),a=[],l=this.$template,g;g=new Date;g=(new Date(g.getFullYear(),g.getMonth(),g.getDate())).getTime();a.push('<table width="100%" border="0" cellspacing="0" cellpadding="0">');a.push("<tbody>");a.push("<tr>");for(var n=0,t=f.length;n<t;n++)a.push("<th>"+f[n]+"</th>");a.push("</tr>");n=0;for(t=k.length;n<t;n++){f=k[n];a.push("<tr>");for(var u=0,v=f.length;u<v;u++){var h=f[u],m=["datepicker-cell"],q=(new Date(h.y,h.m-1,h.d)).getTime(),p=q===g,r=b==h.y&&c==h.m&&d==h.d,q=q<e.between[0]||q>e.between[1];h.s=h.s||"current-month";m.push(h.s);p&&m.push("current");!q&&r&&m.push("selected");q&&m.push("disabled");a.push('<td data-year="'+h.y+'" data-month="'+h.m+'" data-day="'+h.d+'" data-action="day" class="'+m.join(" ")+'" >'+("current-month"==h.s?'<a href="javascript:void(0)">'+h.d+"</a>":h.d)+"</td>")}a.push("</tr>")}a.push("</tbody>");l&&l.length&&(b=this.cache.dateArr,l.find(".sd-datepicker-year").html(b[0]),l.find(".sd-datepicker-month").html(b[1]),l.find(".sd-datepicker-body").html(a.join("\n")),this.options.onSelect.call(this));return this},_getDays:function(a,b){for(var c=[],d=[],e=(new Date(a,b,0)).getDate(),f=1;f<=e;f++){var k=(new Date(a,b-1,f)).getDay();d.push({y:a,m:b,d:f,w:k});6==k&&(c.push(d),d=[])}d.length&&c.push(d);var d=c[0],l=d[0],e=d.length,f=function(a){for(var b=[],c=1;c<=7-a;c++){var d=new Date(l.y,l.m-1,l.d-c);b.unshift({y:d.getFullYear(),m:d.getMonth()+1,d:d.getDate(),w:d.getDay(),s:"prev-month"})}return b};7>e?c[0]=f(e).concat(d):c.unshift(f(0));var g=c[c.length-1],d=g.length,e=function(a){for(var b=[],c=g[g.length-1],d=1;d<=7-a;d++){var e=new Date(c.y,c.m-1,c.d+d);b.push({y:e.getFullYear(),m:e.getMonth()+1,d:e.getDate(),w:e.getDay(),s:"next-month"})}return b};7>d&&(g=c[c.length-1]=g.concat(e(d)));6>c.length&&c.push(e(0));return c},_format:function(){var a=this.options,b=function(a,b){for(var e=a.toString().length,e=(b||2)-e;0<e;)a="0"+a,e--;return a};this.cache.dateArr=[b(a.year,4),b(a.month),b(a.day)];return this.cache.dateArr.join(a.splitchar)},setValue:function(a){var b=this.options,c=this.cache;(a=this.match(a))?(b.year=+a[1],b.month=+a[2],b.day=+a[3],this.el.value=c.value=this._format()):(a=new Date,b.year=a.getFullYear(),b.month=a.getMonth()+1,b.day=a.getDate(),c.value=this._format());c.year=b.year;c.month=b.month;c.day=b.day;return this},getValue:function(){return this.el.value},show:function(){var a=this;a.$template&&a.$template.show();a.$body.off(".datepicker").on("click.datepicker",function(){a.hide()});a.options.onShow.call(a);return a},hide:function(){this.$template&&this.$template.hide();this.options.onHide.call(this);return this},reset:function(){var a=this.options,b=a.current;a.year=b.getFullYear();a.month=b.getMonth()+1;a.day=b.getDate();this.setValue();return this},match:function(a){return(new RegExp(["^(19\\d{2}|2\\d{3})","(0[1-9]|1[0-2])","(0[1-9]|[1-2]\\d|3[0-1])$"].join(this.options.splitchar))).exec(a)},validate:function(a){return(a=this.match(a))&&a[3]<=(new Date(a[1],a[2],0)).getDate()}};r.DatePicker=p})(window,jQuery);